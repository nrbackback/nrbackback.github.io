---
title: DNS报文详解
date: 2023-03-02 16:00:00
categories:
- 网络
---
## 乱七八糟的整理

![image-20230302163519309](/Users/rhettnina/我的本地文件/代码/my/nrbackback.github.io/img/image-20230302163519309.png)

分割线，下面的是之前的旧写法


----------

![image-20230302163519309](/Users/rhettnina/我的本地文件/代码/my/nrbackback.github.io/source/images/image-20230302163519309.png)

数据包在DNS之后还有2段数据，分别是以太网的Trailer和以太网帧校验序列（FCS）。

http://c.biancheng.net/view/6457.html

附加资源记录数：额外的记录数目（权威名称服务器对应 IP 地址的数目）。

AA（Authoritative）：授权应答，该字段在响应报文中有效。值为 1 时，表示名称服务器是权威服务器；值为 0 时，表示不是**权威服务器**。

什么叫权威服务器？？？

> 来自chatgpt
>
> 在DNS中，权威服务器（Authoritative Server）是指能够对某个域名或主机名提供官方答案的DNS服务器。权威服务器通常是负责管理域名解析信息的DNS服务器，**它们保存有该域名下所有主机的IP地址等DNS记录，可以直接回答该域名下主机的DNS查询请求。**而非权威服务器则是指没有权威性的DNS服务器，它们通常只是缓存了其他服务器的DNS查询结果，以提高DNS查询效率。

RD和RA是什么意思？看不懂。。

**查询名：一般为要查询的域名，有时也会是 IP 地址，用于反向查询。**

> dig（域信息搜索器）是一个在Linux和Unix系统中常用的网络工具，用于查询DNS域名解析相关信息，比如查询域名对应的IP地址、查询DNS服务器的相关信息、查询DNS记录等等。
>
> 它可以通过指定参数和选项进行各种类型的DNS查询，包括常用的A记录、MX记录、CNAME记录等等，还可以设置查询的DNS服务器，以及查询的超时时间等等。同时，dig也可以用于诊断DNS相关的问题，比如检查DNS服务器是否正常工作、解析是否正确等等。

执行nslookup xxx.com时，确认本地DNS服务器是否已经缓存了查询结果。如果本地DNS服务器已经缓存了查询结果，就不会再向上级DNS服务器发出请求了。

> 在DNS报文中，NS是Name Server Record的缩写，用于指定该域名的授权域名服务器；而A是Address Record的缩写，用于将域名解析为IPv4地址。具体来说：
>
> - NS记录：NS记录是一个指针记录，它指向一组该域名授权的域名服务器的名称。当客户端要查询该域名下的某个主机的IP地址时，需要先向授权域名服务器查询，因此NS记录在DNS解析过程中非常重要。
> - A记录：A记录是最基本的DNS记录类型，它将域名解析为IPv4地址。例如，将www.example.com解析为192.0.2.1。
>
> 在DNS报文中，NS记录和A记录都可以作为Answer Section的一部分返回给客户端。其中NS记录用于指定授权域名服务器，A记录用于指定主机的IPv4地址。

> 使用 `dig +trace` 命令会追踪域名解析过程并输出每个步骤的详细信息。**它不会使用DNS缓存，它会从根域名服务器开始，**递归地查询每个级别的 DNS 服务器，直到找到目标域名的 IP 地址或遇到错误。该命令对于诊断 DNS 解析问题非常有用，可以帮助确定哪个服务器出现了问题或哪个环节出现了延迟。

这是执行 ` dig +trace qwewq.com`抓到的包，首先访问了192.5.5.241

> IP地址 192.5.5.241 是由美国国家科学基金会（NSF）资助的互联网核心枢纽机构 VeriSign 公司拥有的一个地址，**是一个根域名服务器**，主要用于管理和运营域名系统（DNS）服务器，其中包括 .com 和 .net 域名的顶级域名服务器。

![image-20230302180706556](/Users/rhettnina/我的本地文件/代码/my/nrbackback.github.io/source/images/image-20230302180706556.png)

如果不特意指定+trace只是正常访问，抓到的包结果如下，首先访问了8.8.8.8

![image-20230302181137764](/Users/rhettnina/我的本地文件/代码/my/nrbackback.github.io/source/images/image-20230302181137764.png)

这是因为我在电脑的系统设置中配置的DNS地址是8.8.8.8

![image-20230302181257209](/Users/rhettnina/我的本地文件/代码/my/nrbackback.github.io/source/images/image-20230302181257209.png)

> 8.8.8.8是Google提供的公共DNS服务器的IP地址。**它不是根域名服务器，而是一个提供DNS解析服务的服务器。**
